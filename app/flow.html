<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ki·∫øn tr√∫c AI Shopping Chatbot - S∆° ƒë·ªì Ho√†n ch·ªânh</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 36px;
            font-weight: bold;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
            font-size: 18px;
        }
        
        .architecture-diagram {
            background: linear-gradient(to bottom, #f7fafc, #edf2f7);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .layer {
            margin: 30px 0;
            position: relative;
        }
        
        .layer-title {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 16px;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }
        
        .components-row {
            display: flex;
            justify-content: center;
            gap: 25px;
            flex-wrap: wrap;
            position: relative;
        }
        
        .component {
            background: white;
            border: 4px solid;
            border-radius: 15px;
            padding: 20px;
            min-width: 250px;
            max-width: 400px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .component:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }
        
        .component-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(0,0,0,0.1);
        }
        
        .component-icon {
            font-size: 24px;
        }
        
        .component-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .component-subtitle {
            font-size: 13px;
            color: #718096;
            margin-bottom: 12px;
            font-style: italic;
        }
        
        .component-features {
            list-style: none;
            padding: 0;
        }
        
        .component-features li {
            padding: 5px 0;
            font-size: 13px;
            color: #4a5568;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        
        .component-features li:before {
            content: "‚ñ∏";
            color: #4299e1;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .component.frontend {
            border-color: #4299e1;
            background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
        }
        
        .component.gateway {
            border-color: #48bb78;
            background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
        }
        
        .component.redis {
            border-color: #f56565;
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
        }
        
        .component.kafka {
            border-color: #ed8936;
            background: linear-gradient(135deg, #fffaf0 0%, #feebc8 100%);
        }
        
        .component.backend {
            border-color: #9f7aea;
            background: linear-gradient(135deg, #faf5ff 0%, #e9d8fd 100%);
        }
        
        .component.ai {
            border-color: #ec4899;
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
        }
        
        .component.database {
            border-color: #38b2ac;
            background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
        }
        
        .arrow-container {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }
        
        .arrow {
            font-size: 40px;
            color: #cbd5e0;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .arrow-label {
            display: inline-block;
            background: #4299e1;
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(66, 153, 225, 0.3);
        }
        
        .connection-arrows {
            text-align: center;
            font-size: 30px;
            color: #cbd5e0;
            margin: 15px 0;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .connection-label {
            background: #edf2f7;
            color: #4a5568;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            display: inline-block;
            margin: 0 5px;
        }
        
        .flow-details {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .flow-details h2 {
            color: #2d3748;
            margin-bottom: 25px;
            font-size: 28px;
            text-align: center;
            border-bottom: 3px solid #4299e1;
            padding-bottom: 15px;
        }
        
        .flow-step {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-left: 5px solid #4299e1;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .flow-step-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .step-number {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(66, 153, 225, 0.3);
        }
        
        .flow-step h3 {
            color: #2d3748;
            font-size: 20px;
            flex: 1;
        }
        
        .flow-step-content {
            color: #4a5568;
            line-height: 1.8;
            font-size: 15px;
        }
        
        .code-block {
            background: #2d3748;
            color: #68d391;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 15px 0;
            line-height: 1.6;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .code-block .comment {
            color: #90cdf4;
        }
        
        .code-block .keyword {
            color: #f687b3;
        }
        
        .code-block .string {
            color: #fbd38d;
        }
        
        .tech-stack {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .tech-stack h2 {
            color: #2d3748;
            margin-bottom: 25px;
            font-size: 28px;
            text-align: center;
            border-bottom: 3px solid #48bb78;
            padding-bottom: 15px;
        }
        
        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .tech-card {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border: 3px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .tech-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border-color: #4299e1;
        }
        
        .tech-card h4 {
            color: #2d3748;
            font-size: 18px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tech-card ul {
            list-style: none;
            padding: 0;
        }
        
        .tech-card li {
            padding: 6px 0;
            font-size: 14px;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tech-card li:before {
            content: "‚úì";
            color: #48bb78;
            font-weight: bold;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #fef5e7, #fdebd0);
            border: 3px solid #f39c12;
            border-radius: 15px;
            padding: 25px;
            margin-top: 40px;
        }
        
        .highlight-box h3 {
            color: #d68910;
            margin-bottom: 15px;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .highlight-box ul {
            list-style: none;
            padding: 0;
        }
        
        .highlight-box li {
            padding: 10px 0;
            color: #7d6608;
            font-size: 15px;
            line-height: 1.6;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .highlight-box li:before {
            content: "‚ö°";
            flex-shrink: 0;
        }
        
        .data-flow-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .data-flow-table th {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            padding: 15px;
            text-align: left;
            font-size: 14px;
            font-weight: bold;
        }
        
        .data-flow-table td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
            color: #4a5568;
        }
        
        .data-flow-table tr:hover {
            background: #f7fafc;
        }
        
        .summary-box {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            color: white;
            border-radius: 20px;
            padding: 40px;
            margin-top: 50px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .summary-box h2 {
            font-size: 32px;
            margin-bottom: 20px;
            color: #68d391;
        }
        
        .summary-box p {
            font-size: 18px;
            line-height: 1.8;
            max-width: 1000px;
            margin: 0 auto 20px;
            color: #e2e8f0;
        }
        
        .summary-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 48px;
            font-weight: bold;
            color: #68d391;
            display: block;
        }
        
        .stat-label {
            font-size: 14px;
            color: #cbd5e0;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Ki·∫øn tr√∫c AI Shopping Chatbot</h1>
        <p class="subtitle">S∆° ƒë·ªì ho√†n ch·ªânh v·ªõi FE, API Gateway, Redis, Kafka, Backend Services v√† Database</p>
        
        <div class="architecture-diagram">
            <!-- Layer 1: Frontend -->
            <div class="layer">
                <div class="layer-title">üì± LAYER 1: FRONTEND</div>
                <div class="components-row">
                    <div class="component frontend">
                        <div class="component-header">
                            <span class="component-icon">üíª</span>
                            <span class="component-title">Web/Mobile Application</span>
                        </div>
                        <div class="component-subtitle">React.js + Socket.io Client</div>
                        <ul class="component-features">
                            <li>T·∫°o session_id (UUID v4) cho user</li>
                            <li>Chat UI v·ªõi real-time messaging</li>
                            <li>WebSocket connection cho instant response</li>
                            <li>LocalStorage ƒë·ªÉ persist session</li>
                            <li>Product cards & quick actions</li>
                            <li>Shopping cart integration</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="arrow-container">
                <div class="arrow">‚Üì</div>
                <div class="arrow-label">HTTP/WebSocket Request + JWT Token</div>
            </div>
            
            <!-- Layer 2: API Gateway -->
            <div class="layer">
                <div class="layer-title">üö™ LAYER 2: API GATEWAY</div>
                <div class="components-row">
                    <div class="component gateway">
                        <div class="component-header">
                            <span class="component-icon">üõ°Ô∏è</span>
                            <span class="component-title">API Gateway (Kong)</span>
                        </div>
                        <div class="component-subtitle">Centralized Entry Point</div>
                        <ul class="component-features">
                            <li><strong>Authentication:</strong> JWT validation</li>
                            <li><strong>Rate Limiting:</strong> 10 req/min per user</li>
                            <li><strong>Load Balancing:</strong> Round-robin</li>
                            <li><strong>Request Transformation:</strong> Header injection</li>
                            <li><strong>Monitoring:</strong> Prometheus metrics</li>
                            <li><strong>Logging:</strong> Centralized logging</li>
                            <li><strong>Circuit Breaker:</strong> Fault tolerance</li>
                            <li><strong>SSL Termination:</strong> HTTPS</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="arrow-container">
                <div class="arrow">‚Üì</div>
                <div class="arrow-label">Validated & Authenticated Request</div>
            </div>
            
            <!-- Layer 3: Backend Services -->
            <div class="layer">
                <div class="layer-title">üîß LAYER 3: BACKEND SERVICES</div>
                <div class="components-row">
                    <div class="component backend">
                        <div class="component-header">
                            <span class="component-icon">üí¨</span>
                            <span class="component-title">Chat API Service</span>
                        </div>
                        <div class="component-subtitle">Node.js + Express + Socket.io</div>
                        <ul class="component-features">
                            <li><strong>Session Management:</strong> Redis check & update</li>
                            <li><strong>Message Router:</strong> Route to appropriate handler</li>
                            <li><strong>Kafka Producer:</strong> Publish to chat-requests</li>
                            <li><strong>Kafka Consumer:</strong> Subscribe chat-responses</li>
                            <li><strong>WebSocket Manager:</strong> Real-time connection</li>
                            <li><strong>Response Formatter:</strong> Format for FE</li>
                            <li><strong>Error Handler:</strong> Graceful error handling</li>
                        </ul>
                    </div>
                    
                    <div class="component backend">
                        <div class="component-header">
                            <span class="component-icon">üì¶</span>
                            <span class="component-title">Order Service</span>
                        </div>
                        <div class="component-subtitle">Node.js + Express</div>
                        <ul class="component-features">
                            <li><strong>Create Order:</strong> Insert to orders table</li>
                            <li><strong>Payment Processing:</strong> Payment gateway integration</li>
                            <li><strong>Order Tracking:</strong> Real-time status updates</li>
                            <li><strong>Inventory Check:</strong> Verify stock availability</li>
                            <li><strong>Notification:</strong> Send order confirmation</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="connection-arrows">
                <span>‚Üô</span>
                <span class="connection-label">Check Session</span>
                <span>‚Üì</span>
                <span class="connection-label">Publish Message</span>
                <span>‚Üò</span>
            </div>
            
            <!-- Layer 4: Cache & Message Queue -->
            <div class="layer">
                <div class="layer-title">‚ö° LAYER 4: CACHE & MESSAGE QUEUE</div>
                <div class="components-row">
                    <div class="component redis">
                        <div class="component-header">
                            <span class="component-icon">‚ö°</span>
                            <span class="component-title">Redis Cache</span>
                        </div>
                        <div class="component-subtitle">In-Memory Data Store</div>
                        <ul class="component-features">
                            <li><strong>Session Storage:</strong> TTL 30min auto-extend</li>
                            <li><strong>Chat History:</strong> Last 50 messages cached</li>
                            <li><strong>User Context:</strong> Preferences & search history</li>
                            <li><strong>Product Cache:</strong> Frequently viewed items</li>
                            <li><strong>Shop Cache:</strong> Shop info & URLs</li>
                            <li><strong>Auto Cleanup:</strong> Expired keys removed</li>
                            <li><strong>Pub/Sub:</strong> Real-time notifications</li>
                        </ul>
                    </div>
                    
                    <div class="component kafka">
                        <div class="component-header">
                            <span class="component-icon">üì®</span>
                            <span class="component-title">Apache Kafka</span>
                        </div>
                        <div class="component-subtitle">Event Streaming Platform</div>
                        <ul class="component-features">
                            <li><strong>Topic: chat-requests</strong>
                                <ul style="margin-left: 15px; margin-top: 5px;">
                                    <li style="font-size: 12px;">Producer: Chat API Service</li>
                                    <li style="font-size: 12px;">Consumer: AI Service</li>
                                    <li style="font-size: 12px;">Partitions: 3 (for scalability)</li>
                                </ul>
                            </li>
                            <li><strong>Topic: chat-responses</strong>
                                <ul style="margin-left: 15px; margin-top: 5px;">
                                    <li style="font-size: 12px;">Producer: AI Service</li>
                                    <li style="font-size: 12px;">Consumer: Chat API Service</li>
                                    <li style="font-size: 12px;">Retention: 7 days</li>
                                </ul>
                            </li>
                            <li><strong>Topic: user-events</strong>
                                <ul style="margin-left: 15px; margin-top: 5px;">
                                    <li style="font-size: 12px;">For analytics & tracking</li>
                                </ul>
                            </li>
                            <li><strong>High Throughput:</strong> 1M+ messages/sec</li>
                            <li><strong>Fault Tolerant:</strong> Replication factor: 3</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="arrow-container">
                <div class="arrow">‚Üì</div>
                <div class="arrow-label">AI Service consumes from chat-requests topic</div>
            </div>
            
            <!-- Layer 5: AI Service -->
            <div class="layer">
                <div class="layer-title">ü§ñ LAYER 5: AI SERVICE</div>
                <div class="components-row">
                    <div class="component ai">
                        <div class="component-header">
                            <span class="component-icon">üß†</span>
                            <span class="component-title">AI Service</span>
                        </div>
                        <div class="component-subtitle">Python + LangChain + FastAPI</div>
                        <ul class="component-features">
                            <li><strong>Kafka Consumer:</strong> Subscribe chat-requests</li>
                            <li><strong>Intent Recognition:</strong> Classify user intent
                                <ul style="margin-left: 15px; margin-top: 5px;">
                                    <li style="font-size: 11px;">product_search, price_inquiry, order_create</li>
                                    <li style="font-size: 11px;">shop_info, order_status, general_chat</li>
                                </ul>
                            </li>
                            <li><strong>Entity Extraction:</strong> NER for products, prices</li>
                            <li><strong>Vector Search:</strong> RAG with Pinecone
                                <ul style="margin-left: 15px; margin-top: 5px;">
                                    <li style="font-size: 11px;">Semantic search cho products</li>
                                    <li style="font-size: 11px;">Top-k similar items</li>
                                </ul>
                            </li>
                            <li><strong>Database Query:</strong> PostgreSQL for exact data</li>
                            <li><strong>LLM Generation:</strong> GPT-4/Claude response</li>
                            <li><strong>Product Recommendation:</strong> Based on context</li>
                            <li><strong>Kafka Producer:</strong> Publish to chat-responses</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="connection-arrows">
                <span>‚Üô</span>
                <span class="connection-label">Query Data</span>
                <span>‚Üì</span>
                <span class="connection-label">Get Products/Shops</span>
                <span>‚Üò</span>
            </div>
            
            <!-- Layer 6: Database -->
            <div class="layer">
                <div class="layer-title">üíæ LAYER 6: DATABASE</div>
                <div class="components-row">
                    <div class="component database">
                        <div class="component-header">
                            <span class="component-icon">üóÑÔ∏è</span>
                            <span class="component-title">PostgreSQL</span>
                        </div>
                        <div class="component-subtitle">Transactional Database</div>
                        <ul class="component-features">
                            <li><strong>products table:</strong> product_id, product_name, price, images, category, status, shop_id</li>
                            <li><strong>shops table:</strong> shop_id, shop_name, shop_url, phone_number, address</li>
                            <li><strong>orders table:</strong> M√£ s·∫£n ph·∫©m, Gi√°, S·ªë l∆∞·ª£ng, Status, User info, Payment status</li>
                            <li><strong>users table:</strong> user_id, user_name, email, phone, address</li>
                            <li><strong>Indexes:</strong> On product_name, shop_id, status</li>
                            <li><strong>Full-text Search:</strong> For product search</li>
                        </ul>
                    </div>
                    
                    <div class="component database">
                        <div class="component-header">
                            <span class="component-icon">üìä</span>
                            <span class="component-title">MongoDB</span>
                        </div>
                        <div class="component-subtitle">Document Database</div>
                        <ul class="component-features">
                            <li><strong>conversations collection:</strong> Session chat logs</li>
                            <li><strong>user_interactions:</strong> Click tracking, dwell time</li>
                            <li><strong>analytics_events:</strong> User behavior analytics</li>
                            <li><strong>feedback:</strong> User ratings & reviews</li>
                            <li><strong>Flexible Schema:</strong> Easy to add fields</li>
                            <li><strong>Time-series:</strong> Chat history over time</li>
                        </ul>
                    </div>
                    
                    <div class="component database">
                        <div class="component-header">
                            <span class="component-icon">üîç</span>
                            <span class="component-title">Pinecone (Vector DB)</span>
                        </div>
                        <div class="component-subtitle">Vector Search Engine</div>
                        <ul class="component-features">
                            <li><strong>Product Embeddings:</strong> text-embedding-3-large</li>
                            <li><strong>Semantic Search:</strong> Find similar products</li>
                            <li><strong>RAG Knowledge Base:</strong> Product descriptions</li>
                            <li><strong>Hybrid Search:</strong> Combine with keyword search</li>
                            <li><strong>Fast Retrieval:</strong> < 50ms query time</li>
                            <li><strong>Metadata Filtering:</strong> Price, category, shop</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="arrow-container">
                <div class="arrow">‚Üë</div>
                <div class="arrow-label">Response flows back through Kafka ‚Üí Chat API ‚Üí FE</div>
            </div>
        </div>
        
        <div class="flow-details">
            <h2>üîÑ Chi ti·∫øt Lu·ªìng d·ªØ li·ªáu (Step by Step)</h2>
            
            <div class="flow-step">
                <div class="flow-step-header">
                    <div class="step-number">1</div>
                    <h3>User g·ª≠i message t·ª´ Frontend</h3>
                </div>
                <div class="flow-step-content">
                    <p><strong>H√†nh ƒë·ªông:</strong> User nh·∫≠p message "T√¨m iPhone 15 Pro Max gi√° d∆∞·ªõi 30 tri·ªáu" v√† nh·∫•n g·ª≠i.</p>
                    <div class="code-block">
<span class="comment">// Frontend (React)</span>
<span class="keyword">const</span> sendMessage = <span class="keyword">async</span> (message) => {
  <span class="comment">// Get or create session_id</span>
  <span class="keyword">let</span> sessionId = localStorage.getItem(<span class="string">'session_id'</span>);
  <span class="keyword">if</span> (!sessionId) {
    sessionId = uuidv4(); <span class="comment">// Generate new UUID</span>
    localStorage.setItem(<span class="string">'session_id'</span>, sessionId);
  }
  
  <span class="comment">// Prepare message payload</span>
  <span class="keyword">const</span> payload = {
    session_id: sessionId,
    user_id: currentUser.id,
    message: message,
    timestamp: <span class="keyword">new</span> Date().toISOString()
  };
  
  <span class="comment">// Send via WebSocket</span>
  socket.emit(<span class="string">'chat:message'</span>, payload);
  
  <span class="comment">// Update UI immediately (optimistic update)</span>
  addMessageToUI({ role: <span class="string">'user'</span>, content: message });
};
                    </div>
                    <p><strong>K·∫øt qu·∫£:</strong> Message ƒë∆∞·ª£c g·ª≠i qua WebSocket connection ƒë·∫øn API Gateway.</p>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="flow-step-header">
                    <div class="step-number">2</div>
                    <h3>API Gateway validate & route</h3>
                </div>
                <div class="flow-step-content">
                    <p><strong>H√†nh ƒë·ªông:</strong> Kong Gateway nh·∫≠n request v√† th·ª±c hi·ªán validation.</p>
                    <div class="code-block">
<span class="comment"># Kong Gateway Configuration (YAML)</span>
routes:
  - name: chat-api-route
    paths:
      - /api/chat
    methods:
      - GET
      - POST
    plugins:
      <span class="comment"># 1. JWT Authentication</span>
      - name: jwt
        config:
          claims_to_verify:
            - exp
          key_claim_name: iss
      
      <span class="comment"># 2. Rate Limiting (10 requests/min per user)</span>
      - name: rate-limiting
        config:
          minute: 10
          limit_by: consumer
          policy: local
      
      <span class="comment"># 3. Request Transformer</span>
      - name: request-transformer
        config:
          add:
            headers:
              - X-Gateway-Timestamp: $(date)
      
      <span class="comment"># 4. Prometheus Metrics</span>
      - name: prometheus
    
    <span class="comment"># Load balance to Chat API Service instances</span>
    service:
      name: chat-api-service
      url: http://chat-api:3000
      load_balancing:
        type: round-robin
                    </div>
                    <p><strong>K·∫øt qu·∫£:</strong> Request ƒë∆∞·ª£c validate v√† route ƒë·∫øn Chat API Service.</p>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="flow-step-header">
                    <div class="step-number">3</div>
                    <h3>Chat API Service - Check Redis Session</h3>
                </div>
                <div class="flow-step-content">
                    <p><strong>H√†nh ƒë·ªông:</strong> Chat API Service ki·ªÉm tra session trong Redis.</p>
                    <div class="code-block">
<span class="comment">// Chat API Service (Node.js)</span>
<span class="keyword">const</span> handleChatMessage = <span class="keyword">async</span> (req, res) => {
  <span class="keyword">const</span> { session_id, user_id, message } = req.body;
  
  <span class="comment">// 1. Check Redis for existing session</span>
  <span class="keyword">const</span> sessionKey = `session:${session_id}`;
  <span class="keyword">let</span> sessionData = <span class="keyword">await</span> redis.get(sessionKey);
  
  <span class="keyword">if</span> (!sessionData) {
    <span class="comment">// Create new session</span>
    sessionData = {
      user_id: user_id,
      messages: [],
      context: {
        product_preferences: [],
        price_range: {},
        brands: []
      },
      created_at: <span class="keyword">new</span> Date(),
      last_activity: <span class="keyword">new</span> Date()
    };
    console.log(<span class="string">'‚úì New session created'</span>);
  } <span class="keyword">else</span> {
    sessionData = JSON.parse(sessionData);
    console.log(<span class="string">'‚úì Existing session found'</span>);
  }
  
  <span class="comment">// 2. Add user message to session</span>
  sessionData.messages.push({
    role: <span class="string">'user'</span>,
    content: message,
    timestamp: <span class="keyword">new</span> Date()
  });
  
  sessionData.last_activity = <span class="keyword">new</span> Date();
  
  <span class="comment">// 3. Update Redis with extended TTL (30 minutes)</span>
  <span class="keyword">await</span> redis.setex(
    sessionKey,
    1800, <span class="comment">// 30 minutes in seconds</span>
    JSON.stringify(sessionData)
  );
  
  console.log(<span class="string">'‚úì Session updated in Redis, TTL extended'</span>);
  
  <span class="comment">// Continue to next step...</span>
};
                    </div>
                    <p><strong>K·∫øt qu·∫£:</strong> Session ƒë∆∞·ª£c t·∫°o m·ªõi ho·∫∑c load t·ª´ Redis, v√† TTL ƒë∆∞·ª£c extend th√™m 30 ph√∫t.</p>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="flow-step-header">
                    <div class="step-number">4</div>
                    <h3>Chat API Service - Publish to Kafka</h3>
                </div>
                <div class="flow-step-content">
                    <p><strong>H√†nh ƒë·ªông:</strong> Chat API Service publish message v√†o Kafka topic "chat-requests".</p>
                    <div class="code-block">
<span class="comment">// Chat API Service (Node.js) - continued</span>
<span class="keyword">const</span> handleChatMessage = <span class="keyword">async</span> (req, res) => {
  <span class="comment">// ... (previous code)</span>
  
  <span class="comment">// 4. Prepare message for Kafka</span>
  <span class="keyword">const</span> kafkaMessage = {
    message_id: uuidv4(),
    session_id: session_id,
    user_id: user_id,
    message: message,
    context: sessionData.context,
    chat_history: sessionData.messages.slice(-10), <span class="comment">// Last 10 messages</span>
    timestamp: <span class="keyword">new</span> Date()
  };
  
  <span class="comment">// 5. Publish to Kafka topic "chat-requests"</span>
  <span class="keyword">await</span> kafkaProducer.send({
    topic: <span class="string">'chat-requests'</span>,
    messages: [{
      key: session_id, <span class="comment">// Partition by session_id</span>
      value: JSON.stringify(kafkaMessage)
    }]
  });
  
  console.log(<span class="string">'‚úì Message published to Kafka: chat-requests'</span>);
  
  <span class="comment">// 6. Send immediate acknowledgment to FE</span>
  res.status(202).json({
    status: <span class="string">'processing'</span>,
    message_id: kafkaMessage.message_id,
    message: <span class="string">'Message received and being processed'</span>
  });
};

<span class="comment">// Kafka Producer Setup</span>
<span class="keyword">const</span> kafkaProducer = <span class="keyword">new</span> Kafka({
  clientId: <span class="string">'chat-api-service'</span>,
  brokers: [<span class="string">'kafka:9092'</span>]
}).producer();

<span class="keyword">await</span> kafkaProducer.connect();
                    </div>
                    <p><strong>K·∫øt qu·∫£:</strong> Message ƒë∆∞·ª£c publish v√†o Kafka. User nh·∫≠n acknowledgment ngay l·∫≠p t·ª©c (kh√¥ng ph·∫£i ƒë·ª£i AI x·ª≠ l√Ω).</p>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="flow-step-header">
                    <div class="step-number">5</div>
                    <h3>AI Service - Consume & Process</h3>
                </div>
                <div class="flow-step-content">
                    <p><strong>H√†nh ƒë·ªông:</strong> AI Service consume message t·ª´ Kafka v√† x·ª≠ l√Ω v·ªõi LLM + Database.</p>
                    <div class="code-block">
<span class="comment"># AI Service (Python)</span>
<span class="keyword">from</span> kafka <span class="keyword">import</span> KafkaConsumer, KafkaProducer
<span class="keyword">import</span> json
<span class="keyword">from</span> langchain <span class="keyword">import</span> OpenAI, VectorDBQAChain
<span class="keyword">import</span> psycopg2

<span class="comment"># Kafka Consumer Setup</span>
consumer = KafkaConsumer(
    <span class="string">'chat-requests'</span>,
    bootstrap_servers=[<span class="string">'kafka:9092'</span>],
    value_deserializer=<span class="keyword">lambda</span> m: json.loads(m.decode(<span class="string">'utf-8'</span>)),
    group_id=<span class="string">'ai-service-group'</span>
)

<span class="comment"># Kafka Producer for responses</span>
producer = KafkaProducer(
    bootstrap_servers=[<span class="string">'kafka:9092'</span>],
    value_serializer=<span class="keyword">lambda</span> v: json.dumps(v).encode(<span class="string">'utf-8'</span>)
)

<span class="keyword">for</span> message <span class="keyword">in</span> consumer:
    data = message.value
    
    <span class="comment"># 1. Intent Recognition</span>
    intent = classify_intent(data[<span class="string">'message'</span>])
    <span class="comment"># Output: "product_search"</span>
    
    <span class="comment"># 2. Entity Extraction</span>
    entities = extract_entities(data[<span class="string">'message'</span>])
    <span class="comment"># Output: {"product": "iPhone 15 Pro Max", "price_max": 30000000}</span>
    
    <span class="comment"># 3. Vector Search in Pinecone (RAG)</span>
    query_embedding = get_embedding(data[<span class="string">'message'</span>])
    similar_products = pinecone_index.query(
        vector=query_embedding,
        top_k=10,
        include_metadata=<span class="keyword">True</span>,
        filter={<span class="string">"price"</span>: {<span class="string">"$lte"</span>: 30000000}}
    )
    
    product_ids = [item[<span class="string">'id'</span>] <span class="keyword">for</span> item <span class="keyword">in</span> similar_products[<span class="string">'matches'</span>]]
    
    <span class="comment"># 4. Query PostgreSQL for exact product data</span>
    conn = psycopg2.connect(<span class="string">"dbname=shopping user=postgres"</span>)
    cursor = conn.cursor()
    
    cursor.execute(<span class="string">"""
        SELECT p.*, s.shop_name, s.shop_url, s.phone_number
        FROM products p
        JOIN shops s ON p.shop_id = s.shop_id
        WHERE p.product_id = ANY(%s)
          AND p.discount_price <= %s
          AND p.status = 'available'
        ORDER BY p.discount_price ASC
        LIMIT 5
    """</span>, (product_ids, entities[<span class="string">'price_max'</span>]))
    
    products = cursor.fetchall()
    
    <span class="comment"># 5. Generate response with LLM</span>
    llm_prompt = <span class="string">f"""
    You are a helpful shopping assistant.
    
    User message: {data['message']}
    User context: {data['context']}
    
    Found products:
    {format_products(products)}
    
    Generate a friendly response recommending the best products.
    """</span>
    
    response_text = openai.ChatCompletion.create(
        model=<span class="string">"gpt-4"</span>,
        messages=[{<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: llm_prompt}]
    ).choices[0].message.content
    
    <span class="comment"># 6. Publish response to Kafka</span>
    producer.send(<span class="string">'chat-responses'</span>, {
        <span class="string">'message_id'</span>: data[<span class="string">'message_id'</span>],
        <span class="string">'session_id'</span>: data[<span class="string">'session_id'</span>],
        <span class="string">'response'</span>: response_text,
        <span class="string">'products'</span>: format_products_for_fe(products),
        <span class="string">'intent'</span>: intent,
        <span class="string">'confidence'</span>: 0.95,
        <span class="string">'timestamp'</span>: datetime.now().isoformat()
    })
    
    print(<span class="string">f"‚úì Response published for session {data['session_id']}"</span>)
                    </div>
                    <p><strong>K·∫øt qu·∫£:</strong> AI Service ƒë√£ x·ª≠ l√Ω message, query database, v√† generate response. Response ƒë∆∞·ª£c publish v√†o Kafka topic "chat-responses".</p>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="flow-step-header">
                    <div class="step-number">6</div>
                    <h3>Chat API Service - Consume Response & Update Redis</h3>
                </div>
                <div class="flow-step-content">
                    <p><strong>H√†nh ƒë·ªông:</strong> Chat API Service consume response t·ª´ Kafka, update Redis, v√† g·ª≠i v·ªÅ FE.</p>
                    <div class="code-block">
<span class="comment">// Chat API Service (Node.js) - Kafka Consumer</span>
<span class="keyword">const</span> kafkaConsumer = kafka.consumer({ 
  groupId: <span class="string">'chat-api-consumer-group'</span> 
});

<span class="keyword">await</span> kafkaConsumer.connect();
<span class="keyword">await</span> kafkaConsumer.subscribe({ 
  topic: <span class="string">'chat-responses'</span>,
  fromBeginning: <span class="keyword">false</span>
});

<span class="keyword">await</span> kafkaConsumer.run({
  eachMessage: <span class="keyword">async</span> ({ topic, partition, message }) => {
    <span class="keyword">const</span> data = JSON.parse(message.value.toString());
    
    console.log(<span class="string">`‚úì Received response for session ${data.session_id}`</span>);
    
    <span class="comment">// 1. Update Redis session with AI response</span>
    <span class="keyword">const</span> sessionKey = `session:${data.session_id}`;
    <span class="keyword">let</span> sessionData = JSON.parse(<span class="keyword">await</span> redis.get(sessionKey));
    
    sessionData.messages.push({
      role: <span class="string">'assistant'</span>,
      content: data.response,
      products: data.products,
      timestamp: <span class="keyword">new</span> Date()
    });
    
    <span class="comment">// Update context if needed</span>
    <span class="keyword">if</span> (data.intent === <span class="string">'product_search'</span>) {
      sessionData.context.last_search = data.products[0]?.product_name;
      sessionData.context.product_preferences.push(
        ...data.products.map(p => p.category1)
      );
    }
    
    <span class="comment">// Save to Redis with extended TTL</span>
    <span class="keyword">await</span> redis.setex(
      sessionKey,
      1800,
      JSON.stringify(sessionData)
    );
    
    console.log(<span class="string">'‚úì Redis session updated with AI response'</span>);
    
    <span class="comment">// 2. Save to MongoDB for analytics (async, no await)</span>
    mongoDb.collection(<span class="string">'conversations'</span>).insertOne({
      session_id: data.session_id,
      message_id: data.message_id,
      response: data.response,
      products: data.products,
      intent: data.intent,
      timestamp: <span class="keyword">new</span> Date()
    });
    
    <span class="comment">// 3. Send response to FE via WebSocket</span>
    <span class="keyword">const</span> socket = getSocketBySessionId(data.session_id);
    <span class="keyword">if</span> (socket) {
      socket.emit(<span class="string">'chat:response'</span>, {
        message_id: data.message_id,
        message: data.response,
        products: data.products,
        timestamp: <span class="keyword">new</span> Date()
      });
      console.log(<span class="string">'‚úì Response sent to FE via WebSocket'</span>);
    }
  }
});
                    </div>
                    <p><strong>K·∫øt qu·∫£:</strong> Response ƒë∆∞·ª£c update v√†o Redis, save v√†o MongoDB, v√† g·ª≠i real-time v·ªÅ Frontend qua WebSocket.</p>
                </div>
            </div>
            
            <div class="flow-step">
                <div class="flow-step-header">
                    <div class="step-number">7</div>
                    <h3>Frontend nh·∫≠n response & hi·ªÉn th·ªã</h3>
                </div>
                <div class="flow-step-content">
                    <p><strong>H√†nh ƒë·ªông:</strong> Frontend nh·∫≠n response t·ª´ WebSocket v√† update UI.</p>
                    <div class="code-block">
<span class="comment">// Frontend (React)</span>
socket.on(<span class="string">'chat:response'</span>, (data) => {
  console.log(<span class="string">'‚úì Received AI response'</span>, data);
  
  <span class="comment">// 1. Add AI message to chat UI</span>
  addMessageToUI({
    role: <span class="string">'assistant'</span>,
    content: data.message,
    timestamp: data.timestamp
  });
  
  <span class="comment">// 2. Display product cards if any</span>
  <span class="keyword">if</span> (data.products && data.products.length > 0) {
    displayProductCards(data.products);
  }
  
  <span class="comment">// 3. Add quick action buttons</span>
  addQuickActions([
    { label: <span class="string">'Xem chi ti·∫øt'</span>, action: <span class="string">'view_details'</span> },
    { label: <span class="string">'Th√™m v√†o gi·ªè'</span>, action: <span class="string">'add_to_cart'</span> },
    { label: <span class="string">'So s√°nh gi√°'</span>, action: <span class="string">'compare_prices'</span> }
  ]);
  
  <span class="comment">// 4. Scroll to bottom</span>
  scrollChatToBottom();
});

<span class="comment">// Product card component</span>
<span class="keyword">const</span> ProductCard = ({ product }) => (
  &lt;div className=<span class="string">"product-card"</span>&gt;
    &lt;img src={product.images[0]} alt={product.product_name} /&gt;
    &lt;h3&gt;{product.product_name}&lt;/h3&gt;
    &lt;div className=<span class="string">"price"</span>&gt;
      &lt;span className=<span class="string">"original"</span>&gt;{formatPrice(product.original_price)}&lt;/span&gt;
      &lt;span className=<span class="string">"discount"</span>&gt;{formatPrice(product.discount_price)}&lt;/span&gt;
    &lt;/div&gt;
    &lt;div className=<span class="string">"shop"</span>&gt;
      &lt;span&gt;üè™ {product.shop_name}&lt;/span&gt;
      &lt;a href={product.shop_url} target=<span class="string">"_blank"</span>&gt;Xem shop&lt;/a&gt;
    &lt;/div&gt;
    &lt;button onClick={() => addToCart(product)}&gt;
      Th√™m v√†o gi·ªè h√†ng
    &lt;/button&gt;
  &lt;/div&gt;
);
                    </div>
                    <p><strong>K·∫øt qu·∫£:</strong> User th·∫•y AI response v·ªõi product recommendations ngay l·∫≠p t·ª©c. To√†n b·ªô qu√° tr√¨nh t·ª´ g·ª≠i message ƒë·∫øn nh·∫≠n response ch·ªâ m·∫•t 2-3 gi√¢y!</p>
                </div>
            </div>
        </div>
        
        <div class="tech-stack">
            <h2>üõ†Ô∏è Tech Stack Chi ti·∫øt</h2>
            
            <div class="tech-grid">
                <div class="tech-card">
                    <h4>üì± Frontend</h4>
                    <ul>
                        <li>React 18.x + TypeScript</li>
                        <li>Socket.io Client 4.x</li>
                        <li>TailwindCSS 3.x</li>
                        <li>Redux Toolkit (state management)</li>
                        <li>React Query (data fetching)</li>
                        <li>Framer Motion (animations)</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>üö™ API Gateway</h4>
                    <ul>
                        <li>Kong Gateway 3.x</li>
                        <li>JWT Plugin</li>
                        <li>Rate Limiting Plugin</li>
                        <li>Prometheus Plugin</li>
                        <li>Request Transformer</li>
                        <li>Circuit Breaker</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>üí¨ Chat API Service</h4>
                    <ul>
                        <li>Node.js 20.x LTS</li>
                        <li>Express.js 4.x</li>
                        <li>Socket.io 4.x</li>
                        <li>KafkaJS (Kafka client)</li>
                        <li>ioredis (Redis client)</li>
                        <li>Winston (logging)</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>ü§ñ AI Service</h4>
                    <ul>
                        <li>Python 3.11+</li>
                        <li>FastAPI (API framework)</li>
                        <li>LangChain (LLM orchestration)</li>
                        <li>OpenAI GPT-4 / Claude 3.5</li>
                        <li>kafka-python (Kafka client)</li>
                        <li>psycopg2 (PostgreSQL client)</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>‚ö° Redis</h4>
                    <ul>
                        <li>Redis 7.2.x</li>
                        <li>Redis Cluster (HA)</li>
                        <li>Redis Sentinel (monitoring)</li>
                        <li>RedisInsight (GUI)</li>
                        <li>Memory: 16GB recommended</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>üì® Kafka</h4>
                    <ul>
                        <li>Apache Kafka 3.6.x</li>
                        <li>Zookeeper (coordination)</li>
                        <li>Kafka Connect</li>
                        <li>Schema Registry</li>
                        <li>Kafka UI (management)</li>
                        <li>3 Brokers (replication factor: 3)</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>üóÑÔ∏è PostgreSQL</h4>
                    <ul>
                        <li>PostgreSQL 16.x</li>
                        <li>pgvector extension</li>
                        <li>Full-text search (tsvector)</li>
                        <li>Connection pooling (PgBouncer)</li>
                        <li>Replication (master-slave)</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>üìä MongoDB</h4>
                    <ul>
                        <li>MongoDB 7.x</li>
                        <li>Replica Set (3 nodes)</li>
                        <li>Change Streams (real-time)</li>
                        <li>Time Series Collections</li>
                        <li>MongoDB Atlas (managed)</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>üîç Pinecone</h4>
                    <ul>
                        <li>Pinecone Serverless</li>
                        <li>Embedding model: text-embedding-3-large</li>
                        <li>Dimension: 3072</li>
                        <li>Similarity metric: cosine</li>
                        <li>Metadata filtering enabled</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>üì¶ DevOps</h4>
                    <ul>
                        <li>Docker & Docker Compose</li>
                        <li>Kubernetes (K8s)</li>
                        <li>Helm Charts</li>
                        <li>GitHub Actions (CI/CD)</li>
                        <li>Prometheus + Grafana</li>
                        <li>ELK Stack (logging)</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>‚òÅÔ∏è Cloud Provider</h4>
                    <ul>
                        <li>AWS / GCP / Azure</li>
                        <li>ECS / EKS (container orchestration)</li>
                        <li>S3 / Cloud Storage (images)</li>
                        <li>CloudFront / CDN</li>
                        <li>Route 53 / DNS</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>üîí Security</h4>
                    <ul>
                        <li>JWT Authentication</li>
                        <li>OAuth 2.0 / OpenID Connect</li>
                        <li>SSL/TLS certificates</li>
                        <li>Rate limiting</li>
                        <li>DDoS protection (CloudFlare)</li>
                        <li>Security headers (Helmet.js)</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="highlight-box">
            <h3>üí° Key Design Decisions & Best Practices</h3>
            <ul>
                <li><strong>API Gateway:</strong> Centralized authentication, rate limiting (tr√°nh abuse AI API = ti·∫øt ki·ªám ti·ªÅn!), load balancing, v√† monitoring. Kh√¥ng c√≥ Gateway = h·ªá th·ªëng kh√¥ng professional.</li>
                
                <li><strong>Redis cho Session Management:</strong> TTL 30 ph√∫t auto-extend m·ªói activity. Lookup < 1ms. Auto cleanup expired sessions. Gi·∫£m 90% database queries v·ªõi product cache.</li>
                
                <li><strong>Kafka cho Async Processing:</strong> User kh√¥ng b·ªã block khi AI x·ª≠ l√Ω (2-3 gi√¢y). Message kh√¥ng b·ªã m·∫•t nh·ªù replication. D·ªÖ scale khi traffic tƒÉng. Decoupling services = d·ªÖ maintain.</li>
                
                <li><strong>T√°ch Chat API Service v√† AI Service:</strong> Chat API x·ª≠ l√Ω session/websocket (Node.js). AI Service x·ª≠ l√Ω LLM/ML (Python). Scale ƒë·ªôc l·∫≠p khi c·∫ßn. Failure isolation.</li>
                
                <li><strong>3 Databases cho 3 m·ª•c ƒë√≠ch kh√°c nhau:</strong> PostgreSQL (transactional data), MongoDB (flexible logs & analytics), Pinecone (vector search cho RAG). ƒê√∫ng tool cho ƒë√∫ng vi·ªác!</li>
                
                <li><strong>WebSocket cho Real-time:</strong> Instant response v·ªÅ FE. Bidirectional communication. Typing indicators, presence, notifications.</li>
                
                <li><strong>Rate Limiting = Crucial:</strong> 10 requests/min per user. Tr√°nh abuse AI API. DDoS protection. Fair usage cho t·∫•t c·∫£ users.</li>
                
                <li><strong>Monitoring & Logging:</strong> Prometheus metrics, Grafana dashboards, ELK stack. Track: response time, error rate, cache hit rate, Kafka lag, DB queries.</li>
                
                <li><strong>High Availability:</strong> Redis cluster, Kafka replication, PostgreSQL master-slave, MongoDB replica set. Zero downtime deployment v·ªõi K8s rolling updates.</li>
                
                <li><strong>Cost Optimization:</strong> Cache aggressively (Redis), batch AI requests khi c√≥ th·ªÉ, use cheaper embeddings model, monitor AI API usage, set budget alerts.</li>
            </ul>
        </div>
        
        <div class="flow-details" style="margin-top: 40px;">
            <h2>üìä Data Flow Summary Table</h2>
            
            <table class="data-flow-table">
                <thead>
                    <tr>
                        <th>B∆∞·ªõc</th>
                        <th>Component</th>
                        <th>Action</th>
                        <th>Protocol/Tool</th>
                        <th>Th·ªùi gian</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>1</strong></td>
                        <td>Frontend</td>
                        <td>User g·ª≠i message</td>
                        <td>WebSocket</td>
                        <td>~1ms</td>
                    </tr>
                    <tr>
                        <td><strong>2</strong></td>
                        <td>API Gateway</td>
                        <td>Auth + Rate Limit + Route</td>
                        <td>Kong Gateway</td>
                        <td>~5ms</td>
                    </tr>
                    <tr>
                        <td><strong>3</strong></td>
                        <td>Chat API Service</td>
                        <td>Check/Update Redis session</td>
                        <td>Redis GET/SETEX</td>
                        <td>< 1ms</td>
                    </tr>
                    <tr>
                        <td><strong>4</strong></td>
                        <td>Chat API Service</td>
                        <td>Publish to Kafka</td>
                        <td>Kafka Producer</td>
                        <td>~10ms</td>
                    </tr>
                    <tr>
                        <td><strong>5</strong></td>
                        <td>AI Service</td>
                        <td>Consume from Kafka</td>
                        <td>Kafka Consumer</td>
                        <td>~5ms</td>
                    </tr>
                    <tr>
                        <td><strong>6</strong></td>
                        <td>AI Service</td>
                        <td>Intent + Entity extraction</td>
                        <td>NLP Model</td>
                        <td>~50ms</td>
                    </tr>
                    <tr>
                        <td><strong>7</strong></td>
                        <td>AI Service</td>
                        <td>Vector search</td>
                        <td>Pinecone Query</td>
                        <td>~50ms</td>
                    </tr>
                    <tr>
                        <td><strong>8</strong></td>
                        <td>AI Service</td>
                        <td>Query products</td>
                        <td>PostgreSQL SELECT</td>
                        <td>~20ms</td>
                    </tr>
                    <tr>
                        <td><strong>9</strong></td>
                        <td>AI Service</td>
                        <td>LLM response generation</td>
                        <td>OpenAI GPT-4 API</td>
                        <td>~1500ms</td>
                    </tr>
                    <tr>
                        <td><strong>10</strong></td>
                        <td>AI Service</td>
                        <td>Publish response to Kafka</td>
                        <td>Kafka Producer</td>
                        <td>~10ms</td>
                    </tr>
                    <tr>
                        <td><strong>11</strong></td>
                        <td>Chat API Service</td>
                        <td>Consume response from Kafka</td>
                        <td>Kafka Consumer</td>
                        <td>~5ms</td>
                    </tr>
                    <tr>
                        <td><strong>12</strong></td>
                        <td>Chat API Service</td>
                        <td>Update Redis session</td>
                        <td>Redis SETEX</td>
                        <td>< 1ms</td>
                    </tr>
                    <tr>
                        <td><strong>13</strong></td>
                        <td>Chat API Service</td>
                        <td>Save to MongoDB (async)</td>
                        <td>MongoDB Insert</td>
                        <td>~10ms (non-blocking)</td>
                    </tr>
                    <tr>
                        <td><strong>14</strong></td>
                        <td>Chat API Service</td>
                        <td>Send to Frontend</td>
                        <td>WebSocket Emit</td>
                        <td>~5ms</td>
                    </tr>
                    <tr>
                        <td colspan="4" style="text-align: right; font-weight: bold;">T·ªîNG TH·ªúI GIAN (End-to-End):</td>
                        <td style="font-weight: bold; color: #48bb78; font-size: 16px;">~1.7 gi√¢y</td>
                    </tr>
                </tbody>
            </table>
            
            <p style="margin-top: 20px; color: #4a5568; font-size: 14px; line-height: 1.6;">
                <strong>L∆∞u √Ω:</strong> Th·ªùi gian th·ª±c t·∫ø ph·ª• thu·ªôc v√†o: network latency, server load, AI model speed, database optimization. 
                V·ªõi caching t·ªët v√† infrastructure t·ªëi ∆∞u, response time c√≥ th·ªÉ gi·∫£m xu·ªëng ~1 gi√¢y. 
                Ph·∫ßn l·ªõn th·ªùi gian (85%) l√† ch·ªù LLM response - c√≥ th·ªÉ optimize b·∫±ng streaming response ho·∫∑c d√πng faster models.
            </p>
        </div>
        
</body>
</html>